#!/usr/bin/env janet

(use dotf-path)
(use dotf-utils)
(use dotf-acr)

(defn show-help []
  (def progname (-> (dyn *args*) (first) (path/basename)))
  (eprintf "Usage: %s <TAG>" progname)
  (os/exit 2))

(defn main [arg0 & args]
  (when (not= (length args) 1)
    (show-help))

  (def wiki-dir (getenv-or-die "ACR_WIKI_DIR"))
  (def [tag] args)

  (each [id path] (acr-get-wiki-note-pairs wiki-dir)
    (def header (acr-slurp-header path))
    (def tags-raw (in header :tags))
    (when tags-raw
      (def tags (string/split " " tags-raw))
      (when (find |(= $ tag) tags)
        (printf "%s %s" id (-> header (in :title) (or "<NO TITLE>")))))))
