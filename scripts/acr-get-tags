#!/usr/bin/env janet

(use dotf-path)
(use dotf-utils)
(use dotf-acr)

(defn print-in-format [id tag-line]
  (printf "%s %s" id tag-line))

# (defn show-help []
#   (def progname (-> (dyn *args*) (first) (path/basename)))
#   (eprintf "Usage: %s [PAGE-ID...]" progname)
#   (os/exit 2))

(defn read-tag [id path]
  (def header (acr-slurp-header path))
  (def tag-line (-> header (in :tags) (or "")))
  (print-in-format id tag-line))

(defn read-tags [ids-paths]
  (each [id path] ids-paths
    (read-tag id path)))

(defn main [arg0 & args]
  (def wiki-dir (getenv-or-die "ACR_WIKI_DIR"))

  (defn id->note-pair [id]
    (def path (string wiki-dir "/" id ".acr"))
    [id path])

  (if (empty? args)
    (read-tags (acr-get-wiki-note-pairs wiki-dir))
    (read-tags (map id->note-pair args))))
